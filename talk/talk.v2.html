<!DOCTYPE html>
<html>
  <head>
    <title>Property-based testing -- by Nicolas DUBIEN</title>
    <meta charset="utf-8">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/reveal.js/3.0.0/css/reveal.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/reveal.js/3.0.0/css/theme/black.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/reveal.js/3.0.0/lib/css/zenburn.css">
    <link rel="stylesheet" href="reveal-style.css">
  </head>
  <body>
    <div class="reveal">
        <div class="slides">
            <section>
                <section>
                    <h1>Property-based testing</h1>
                    <h2 class="more">Using <a href="https://github.com/emil-e/rapidcheck/" target="_blank">RapidCheck</a></h2>
                </section>
                <section>
                    <p>Test properties instead of isolated cases</p>
                </section>
                <section>
                    <p class="quote">
                        for all <em>(x, y, ...)</em>
                        <br/>such that <em>precondition(x, y, ...)</em> holds
                        <br/><em>property(x, y, ...)</em> is true
                    </p>
                </section>
                <section>
                    <p>Example:</p>
                    <p class="quote">
                        for all <em>a and b integers</em>
                        <br/>such that <em>a &lt;= b</em> holds
                        <br/><em>a &lt;= mean(a,b) &lt;= b</em> is true
                    </p>
                </section>
                <section>
                    <p>Example:</p>
                    <p class="quote">
                        for all <em>array</em>
                        <br/><span class="fragment">- <em>sorted(array).all(current &lt;= next)</em></span>
                        <br/><span class="fragment">- <em>sorted(array).length == array.length</em></span>
                        <br/><span class="fragment">- <em>arity of(value in sorted(array)) == arity of(value in array)</em></span>
                        <br/><span class="fragment">are true</span>
                    </p>
                </section>
                <section>
                    <p>Use the scope of all possible inputs</p>
                </section>
                <section>
                    <p>Shrink the input in case of failure</p>
                </section>
            </section>
            <section>
                <section>
                    <h2>Agenda</h2>
                    <ol class="agenda">
                        <li>Test as debt</li>
                        <li>Limited coverage</li>
                        <li>Property-based testing in action</li>
                    </ul>
                </section>
            </section>
            <section>
                <section>
                    <h2>Agenda</h2>
                    <ol class="agenda">
                        <li class="active">Test as debt</li>
                        <li>Limited coverage</li>
                        <li>Property-based testing in action</li>
                    </ul>
                </section>
                <section>
                    <ul class="left-menu">
                        <li>Observation</li>
                    </ul>
                    <div class="content">
                        <p>We want to test for various reasons:
                            <span class="fragment">check for possible regressions,</span>
                            <span class="fragment">early bug detection,</span>
                            <span class="fragment">development logic,</span>
                            <span class="fragment">documentation, ...</span>
                        </p>
                        <p class="fragment">We base our faith in tests on the following assumptions:</p>
                        <ul>
                            <li class="fragment">up-to-date</li>
                            <li class="fragment">as simple as possible</li>
                            <li class="fragment">evolve with the code</li>
                            <li class="fragment">wide coverage</li>
                            <li class="fragment">an helper not an end in itself</li>
                        </ul>
                    </div>
                </section>
                <section>
                    <ul class="left-menu">
                        <li>Observation</li>
                    </ul>
                    <div class="content">
                        <p>But what if it was:</p>
                        <ul>
                            <li>costly to maintain</li>
                            <li>blocking or limiting possible improvments</li>
                        </ul>
                    </div>
                </section>
                <section>
                    <ul class="left-menu">
                        <li>Observation</li>
                        <li>Statement</li>
                    </ul>
                    <div class="content">
                        <p>How would you test a JSON serializer given the following specification?</p>
                        <p class="quote">Converts a value to JSON notation representing it.</p>
                        <p>Such specification is the one described by <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/JSON/stringify" title="Mozilla Foundation web docs" target="_blank">Mozilla Foundation web docs</a>
                            for `JSON.stringify` of JavaScript.
                            The exhaustive specification is available on <a href="http://www.ecma-international.org/ecma-262/5.1/#sec-15.12.3" title="ECMA-262" target="_blank">ECMA-262</a>.
                        </p>
                        <pre><code class="hljs cpp" data-trim>
namespace json {
    
    class JsonObject;
    class JsonArray : public JsonObject;
    class JsonDictionary : public JsonObject;
    
    std::string stringify(JsonObject const&amp;);
    std::unique_ptr&lt;JsonObject&gt; parse(std::string const&amp;);
    
}//json
                        </code></pre>
                </section>
                <section>
                    <ul class="left-menu">
                        <li>Observation</li>
                        <li>Statement</li>
                        <li>Easy</li>
                    </ul>
                    <div class="content">
                        <p>Easy, isn't it?</p>
                        <pre class="fragment"><code class="hljs cpp" data-trim>
TEST(Stringify, ObjectWithTwoAttributesAandB) {
    auto instanceWithAandB = json::JsonDictionary {}
            .with("a", json::JsonInteger {4})
            .with("b", json::JsonInteger {7});
    
    ASSERT_EQ(
        std::string{"{\"a\":4,\"b\":7}"},
        json::stringify(instanceWithAandB));
}
                        </code></pre>
                </section>
                <section>
                    <ul class="left-menu">
                        <li>Observation</li>
                        <li>Statement</li>
                        <li>Easy</li>
                        <li><ul>Not really
                            <li>Key ordering</li>
                        </ul></li>
                    </ul>
                    <div class="content">
                        <pre class="fragment"><code class="hljs" data-trim>{"a":4,"b":7}</code></pre>
                        <pre class="fragment"><code class="hljs" data-trim>{"b":7,"a":4}</code></pre>
                        <p class="fragment">Implementation choice:</p>
                        <ul>
                            <li class="fragment">way key-value pairs are stored: vector of pairs, map, hashmap...</li>
                            <li class="fragment">way key-value pairs are iterated</li>
                        </ul>
                </section>
                <section>
                    <ul class="left-menu">
                        <li>Observation</li>
                        <li>Statement</li>
                        <li>Easy</li>
                        <li><ul>Not really
                            <li>Key ordering</li>
                            <li>Deterministic</li>
                        </ul></li>
                    </ul>
                    <div class="content">
                        <p class="fragment">Implementation choice:</p>
                        <ul>
                            <li class="fragment">address based in some way</li>
                            <li class="fragment">depend on previous calls</li>
                        </ul>
                </section>
                <section>
                    <ul class="left-menu">
                        <li>Observation</li>
                        <li>Statement</li>
                        <li>Easy</li>
                        <li><ul>Not really
                            <li>Key ordering</li>
                            <li>Deterministic</li>
                            <li>Ident</li>
                        </ul></li>
                    </ul>
                    <div class="content">
                        <pre class="fragment"><code class="hljs" data-trim>{"a"  :4   ,  "b"  :7     }</code></pre>
                        <pre class="fragment"><code class="hljs" data-trim>{"a":4                    ,"b":7                    }</code></pre>
                        <pre class="fragment"><code class="hljs" data-trim>
{
    "a" : 4,
    "b" : 7
}
                        </code></pre>
                        <p class="fragment">Implementation choice:</p>
                        <ul>
                            <li class="fragment">optimizations: several threads or even processes can feed the output string</li>
                        </ul>
                </section>
                <section>
                    <ul class="left-menu">
                        <li>Observation</li>
                        <li>Statement</li>
                        <li>Easy</li>
                        <li><ul>Not really
                            <li>Key ordering</li>
                            <li>Deterministic</li>
                            <li>Ident</li>
                            <li>Notation</li>
                        </ul></li>
                    </ul>
                    <div class="content">
                        <pre class="fragment"><code class="hljs" data-trim>{"a":4E0,"b":7E0}</code></pre>
                        <pre class="fragment"><code class="hljs" data-trim>{"a":40E-1,"b":7E0}</code></pre>
                        <pre class="fragment"><code class="hljs" data-trim>{"\u0061":4,"b":7}</code></pre>
                        <p class="fragment">Implementation choice:</p>
                        <ul>
                            <li class="fragment">more compact outputs for some values: 3E6 instead of 3000000</li>
                            <li class="fragment">not area specific characters</li>
                        </ul>
                </section>
                <section>
                    <ul class="left-menu">
                        <li>Observation</li>
                        <li>Statement</li>
                        <li>Easy</li>
                        <li>Not really</li>
                        <li>Property</li>
                    </ul>
                    <div class="content">
                        <p>Any idea?</p>
                        <pre class="fragment"><code class="hljs cpp" data-trim>
namespace json {

    std::string stringify(JsonObject const&amp;);
    std::unique_ptr&lt;JsonObject&gt; parse(std::string const&amp;);
    
}//json
                        </code></pre>
                </section>
                <section>
                    <ul class="left-menu">
                        <li>Observation</li>
                        <li>Statement</li>
                        <li>Easy</li>
                        <li>Not really</li>
                        <li>Property</li>
                    </ul>
                    <div class="content">
                        <p>
                            Taking the object resulting from the conversion of the JsonObject to a string then back to a JsonObject
                            should be equivalent to take the original instance itself.
                        </p>
                        <pre><code class="hljs cpp" data-trim>
RC_GTEST_PROP(Stringify,
              StringifyThenParseIsIdentity,
              (json::JsonObject const&amp; elt))
{
    RC_ASSERT(*json::parse(json::stringify(elt)) == elt);
}
                        </code></pre>
                </section>
            </section>
            <section>
                <section>
                    <h2>Agenda</h2>
                    <ol class="agenda">
                        <li>Test as debt</li>
                        <li class="active">Limited coverage</li>
                        <li>Property-based testing in action</li>
                    </ul>
                </section>
            </section>
            <section>
                <section>
                    <h2>Agenda</h2>
                    <ol class="agenda">
                        <li>Test as debt</li>
                        <li>Limited coverage</li>
                        <li class="active">Property-based testing in action</li>
                    </ul>
                </section>
            </section>
        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/reveal.js/3.0.0/lib/js/head.min.js"></script>
    <script src="https://cdn.jsdelivr.net/reveal.js/3.0.0/js/reveal.min.js"></script>
    <script src="reveal-config.js"></script>
    <script src="reveal-mouse.js"></script>
  </body>
</html>